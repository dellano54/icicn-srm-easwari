generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum PaperStatus {
  SUBMITTED
  UNDER_REVIEW
  AWAITING_DECISION
  ACCEPTED_UNPAID
  PAYMENT_VERIFICATION
  REGISTERED
  REJECTED
}

enum Tier {
  TIER_1
  TIER_2
  TIER_3
}

enum Decision {
  ACCEPT
  REJECT
}

// User (Team) Model
model User {
  id            String   @id @default(uuid())
  teamName      String
  email         String   @unique
  password      String   // Hashed Access Code
  mentorName    String
  mentorDept    String
  country       String   @default("India")
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  members       Member[]
  paper         Paper?
}

// Member Model
model Member {
  id          String @id @default(uuid())
  name        String
  email       String
  phone       String
  college     String
  department  String
  city        String
  state       String
  country     String
  
  isLead      Boolean @default(false)
  userId      String
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Paper Model
model Paper {
  id              String      @id @default(uuid())
  paperUrl        String
  plagiarismUrl   String
  paymentScreenshotUrl String?
  
  domains         String[]    // Array of domain tags
  
  status          PaperStatus @default(SUBMITTED)
  adminTier       Tier?       // Final Tier assigned by Admin
  
  userId          String      @unique
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  reviews         Review[]
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

// Reviewer Model
model Reviewer {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String   // Hashed password
  domains   String[] // Domains they are qualified to review
  
  reviews   Review[]
}

// Review Model
model Review {
  id          String   @id @default(uuid())
  
  feedback    String?
  decision    Decision?
  tier        Tier?
  
  isCompleted Boolean  @default(false)
  
  paperId     String
  paper       Paper    @relation(fields: [paperId], references: [id], onDelete: Cascade)
  
  reviewerId  String
  reviewer    Reviewer @relation(fields: [reviewerId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([paperId, reviewerId])
}

// Admin Model
model Admin {
  id       String @id @default(uuid())
  email    String @unique
  password String
}